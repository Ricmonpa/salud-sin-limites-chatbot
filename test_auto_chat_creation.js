// Test script para verificar la creaciÃ³n automÃ¡tica de chats
// Ejecutar en la consola del navegador en http://localhost:3002

console.log('ğŸ§ª Iniciando test de creaciÃ³n automÃ¡tica de chats...');

// FunciÃ³n para simular una primera conversaciÃ³n
async function testAutoChatCreation() {
  console.log('1ï¸âƒ£ Verificando estado inicial...');
  
  // Verificar si el usuario estÃ¡ autenticado
  const isAuthenticated = window.isAuthenticated || false;
  const userData = window.userData || null;
  const currentChatId = window.currentChatId || null;
  const messages = window.messages || [];
  
  console.log('Estado actual:', {
    isAuthenticated,
    userData: userData ? 'âœ… Usuario autenticado' : 'âŒ Usuario no autenticado',
    currentChatId,
    messagesLength: messages.length
  });
  
  if (!isAuthenticated) {
    console.log('âŒ Usuario no autenticado. Por favor inicia sesiÃ³n primero.');
    return;
  }
  
  // Verificar si es primera conversaciÃ³n
  const isFirstConversation = !currentChatId && messages.length === 0;
  console.log('Â¿Es primera conversaciÃ³n?', isFirstConversation);
  
  if (!isFirstConversation) {
    console.log('âŒ No es primera conversaciÃ³n. Limpia el estado para probar.');
    return;
  }
  
  console.log('âœ… Condiciones correctas para prueba de creaciÃ³n automÃ¡tica');
  console.log('ğŸ“ Ahora envÃ­a un mensaje para probar la funcionalidad...');
}

// FunciÃ³n para verificar el resultado
function checkAutoChatResult() {
  console.log('2ï¸âƒ£ Verificando resultado de creaciÃ³n automÃ¡tica...');
  
  const chats = window.chats || [];
  const currentChatId = window.currentChatId || null;
  const isCreatingChat = window.isCreatingChat || false;
  
  console.log('Estado despuÃ©s del mensaje:', {
    chatsCount: chats.length,
    currentChatId,
    isCreatingChat,
    chats: chats.map(chat => ({
      id: chat.id,
      name: chat.name,
      isAutoGenerated: chat.isAutoGenerated
    }))
  });
  
  if (chats.length > 0) {
    const autoChat = chats.find(chat => chat.isAutoGenerated);
    if (autoChat) {
      console.log('âœ… Â¡Ã‰XITO! Chat creado automÃ¡ticamente:', autoChat.name);
    } else {
      console.log('âš ï¸ Chat creado pero no marcado como auto-generado');
    }
  } else {
    console.log('âŒ No se creÃ³ ningÃºn chat automÃ¡ticamente');
  }
}

// FunciÃ³n para limpiar estado y probar de nuevo
function resetForTest() {
  console.log('ğŸ”„ Limpiando estado para nueva prueba...');
  
  // Limpiar mensajes
  if (window.setMessages) {
    window.setMessages([]);
  }
  
  // Limpiar chat actual
  if (window.setCurrentChatId) {
    window.setCurrentChatId(null);
  }
  
  console.log('âœ… Estado limpiado. Ahora puedes probar de nuevo.');
}

// Exportar funciones para uso en consola
window.testAutoChatCreation = testAutoChatCreation;
window.checkAutoChatResult = checkAutoChatResult;
window.resetForTest = resetForTest;

console.log('ğŸ§ª Test script cargado. Usa:');
console.log('  - testAutoChatCreation() para verificar estado inicial');
console.log('  - checkAutoChatResult() para verificar resultado');
console.log('  - resetForTest() para limpiar estado y probar de nuevo'); 